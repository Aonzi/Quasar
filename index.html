<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Server</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #2c3e50; color: #ecf0f1; }
        #chat { height: 400px; overflow-y: scroll; border: 1px solid #34495e; padding: 10px; margin-bottom: 10px; background: #34495e; }
        #input { width: 70%; padding: 10px; }
        button { padding: 10px 20px; background: #3498db; color: white; border: none; cursor: pointer; }
        button:hover { background: #2980b9; }
        #username { padding: 10px; margin-bottom: 10px; }
        .message { margin: 5px 0; }
        .system { color: #95a5a6; font-style: italic; }
    </style>
</head>
<body>
    <h1>Simple Network Chat (like Discord)</h1>
    <p>Open this file (index.html) on any device and connect to the server URL below.</p>
    <p><strong>Server URL:</strong> wss://quasar.onrender.com</p>
    <input type="text" id="username" placeholder="Enter your username" required>
    <div id="chat"></div>
    <input type="text" id="input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage();">
    <button onclick="sendMessage();">Send</button>

    <script>
        const socket = io('https://quasar.onrender.com', { transports: ['websocket'] });
        const chat = document.getElementById('chat');
        const input = document.getElementById('input');
        const usernameInput = document.getElementById('username');
        let username = '';

        function addMessage(msg, isSystem = false) {
            const div = document.createElement('div');
            div.className = 'message' + (isSystem ? ' system' : '');
            div.innerHTML = msg;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function sendMessage() {
            const msg = input.value.trim();
            if (msg && username) {
                socket.emit('message', { username, msg });
                input.value = '';
            }
        }

        // Wait for username before connecting
        usernameInput.addEventListener('change', () => {
            username = usernameInput.value.trim();
            if (username) {
                socket.connect();
                addMessage(`Connected as ${username}`, true);
            }
        });

        socket.on('connect', () => {
            socket.emit('join', username);
        });

        socket.on('message', (data) => {
            const time = new Date().toLocaleTimeString();
            addMessage(`[${time}] <strong>${data.username}:</strong> ${data.msg}`);
        });

        socket.on('system', (msg) => {
            addMessage(msg, true);
        });

        socket.on('disconnect', () => {
            addMessage('Disconnected from server.', true);
        });

        // Error handling
        socket.on('connect_error', (err) => {
            console.error('SocketIO connect error:', err);  // Log full error to console
            addMessage(`Connection error: ${err.message || 'Unknown websocket error'}`, true);
        });
    </script>
</body>
</html>
